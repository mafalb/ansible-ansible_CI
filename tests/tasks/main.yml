# vim: set ft=yaml ts=2:
---

- name: debug environment
  debug: var=ansible_env
  tags:
  - never
  - debug

- name: check docker version on travis-CI
  when:
  - ansible_env.TRAVIS
  check_mode: true
  package:
    name: docker-ce
    state: present
  register: _docker_package

- name: assert that the correct docker package is installed on travis-CI
  when:
  - ansible_env.TRAVIS
  assert:
    that:
    - not _docker_package.changed

- debug: msg="{{ item.image }} || {{ item.container }} || {{ item.src }}"
  with_items: "{{ targeted_distributions }}"

- name: docker image for centos7 does exist
  with_items: "{{ targeted_distributions }}"
  docker_image:
    name: "{{ item.image }}"
    path: "{{ ansible_env.TRAVIS_BUILD_DIR + '/files/' + item.src }}"
    state: present

- name: docker container for centos7 is running
  with_items: "{{ targeted_distributions }}"
  docker_container:
    name: "{{ item.container }}"
    image: "{{ item.image }}"
    volumes: /sys/fs/cgroup:/sys/fs/cgroup:ro

- name: add containers to inventory
  changed_when: false
  with_items: "{{ targeted_distributions }}"
  add_host:
    groups: testnodes
    name: "{{ item.container }}"
    ansible_connection: docker

- command: echo gugu
