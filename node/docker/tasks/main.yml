# vim: set ft=yaml ts=2:
---

- name: assertions
  assert:
    that:
      - container_name is defined
      - image_name is defined
      - src is defined

- debug: var=container_name
  tags:
    - never
    - debug
- debug: var=image_name
  tags:
    - never
    - debug
- debug: var=src
  tags:
    - never
    - debug
- debug: var=hostgroups|default(['testnodes'])
  tags:
    - never
    - debug

- name: docker image {{ image_name }} is present
  docker_image:
    name: "{{ image_name }}"
    path: "{{ role_path + '/files/' + src }}"
    state: present

- name: docker container {{ container_name }} is started
  docker_container:
    name: "{{ container_name }}"
    image: "{{ image_name }}"
    volumes: "{{ volumes|default([]) }}"
    state: started
    recreate: "{{ recreate|default(false) }}"

- name: add container to inventory
  changed_when: false
  add_host:
    groups: "{{ hostgroups|default(['testnodes']) }}"
    name: "{{ container_name }}"
    ansible_connection: docker
